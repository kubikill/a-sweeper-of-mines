!function(){"use strict";!function(){function e(e){return document.getElementById(e)}const a={nav:{menuBtn:e("menu-btn"),settingsBtn:e("settings-btn"),newGameBtn:e("newgame-btn"),mineCounter:document.querySelector("#mine-counter > span"),timer:{minutes:e("timer-minutes"),seconds:e("timer-seconds")},hintBtn:e("hint-btn"),markSwapBtn:e("mark-btn")},playarea:{columnNums:e("column-nums"),rowNums:e("row-nums"),board:{tiles:null,container:e("board")},winOverlay:{container:e("win-overlay"),newGameBtn:e("win-new-game-btn"),viewBoardBtn:e("win-view-board-btn")},loseOverlay:{container:e("lose-overlay"),newGameBtn:e("lose-new-game-btn"),viewBoardBtn:e("lose-view-board-btn")}},modals:{container:e("modals"),menu:{container:e("menu-modal"),btns:e("menu-modal-btns")},settings:{container:e("settings-modal"),boardSize:e("settings-boardSize"),customBoard:{container:e("settings-customBoard"),rows:e("settings-boardHeight"),columns:e("settings-boardWidth"),numOfMines:e("settings-mineNum"),maxMines:e("settings-maxMines")},boardApplyWarning:e("settings-applywarning"),tileSize:e("settings-tileSize")}},markCircleDiv:e("markCircle"),markCircle:document.querySelector("#markCircle circle")};let t=[];class n{uncovered=!1;hasMine=!1;numOfNearbyMines=0;markedAsEmpty=!1}const s={state:"initial",minesLeft:20,hints:1,hintMode:!1,clickSwap:!1,time:{minutes:0,seconds:0},board:{rows:10,columns:10,numOfMines:20},boardSize:"small",rowMineCount:[],columnMineCount:[]};let r={board:{rows:10,columns:10,numOfMines:20},boardSize:"small",maxMines:50};const i={small:{rows:10,columns:10,numOfMines:20},medium:{rows:15,columns:15,numOfMines:50},large:{rows:20,columns:20,numOfMines:90},verylarge:{rows:30,columns:30,numOfMines:200}};let o,l=2*a.markCircle.r.baseVal.value*Math.PI;function d(e){const t=l-e/100*l;a.markCircle.style.strokeDashoffset=t}function c(e,a){return e<0||e>=s.board.rows||a<0||a>=s.board.columns||!t[e][a].hasMine?0:1}function m(e,a){let n=0;for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++)0==t&&0==s||(n+=c(e+t,a+s));t[e][a].numOfNearbyMines=n}function u(e,t){return a.playarea.board.container.querySelector(`[data-row="${e}"][data-column="${t}"]`)}function v(e,n){"initial"==s.state?(s.state="underway",function(e,a,n){let r=[];for(let e=0;e<s.board.rows;e++)for(let a=0;a<s.board.columns;a++)r.push({row:e,column:a});s.rowMineCount=new Array(s.board.rows).fill(0),s.columnMineCount=new Array(s.board.columns).fill(0);let i=r.findIndex((t=>t.row==e&&t.column==a));-1!=i&&r.splice(i,1),t[e][a].hasMine=!0;for(let e=1;e<n;e++){let e=Math.floor(Math.random()*r.length);t[r[e].row][r[e].column].hasMine=!0,r.splice(e,1)}for(let e in t)for(let a in t[e])m(parseInt(e),parseInt(a)),t[e][a].hasMine&&(s.rowMineCount[e]++,s.columnMineCount[a]++)}(e,n,s.board.numOfMines),function(){let e="";for(let a of s.rowMineCount)e+=`<div>${a}</div>`;a.playarea.rowNums.innerHTML=e,e="";for(let a of s.columnMineCount)e+=`<div>${a}</div>`;a.playarea.columnNums.innerHTML=e}(),b(e,n),a.nav.mineCounter.innerHTML=s.minesLeft,o=setInterval(g,1e3),s.xyzzyActivated&&x()):"underway"==s.state&&(1==s.hintMode?(b(e,n,!0),s.hints-=1,a.nav.hintBtn.dataset.hints=s.hints,s.hints<=0&&(a.nav.hintBtn.classList.remove("hint-active"),a.nav.hintBtn.classList.add("hint-disabled"),s.hintMode=!1)):b(e,n),a.nav.mineCounter.innerHTML=s.minesLeft)}a.markCircle.style.strokeDasharray=`${l} ${l}`,a.markCircle.style.strokeDashoffset=`${l}`;let y="none";function p(e,a){"underway"!=s.state||t[e][a].uncovered||(t[e][a].markedAsEmpty?("none"==y&&(y="remove"),"remove"==y&&(console.log("removing"),t[e][a].markedAsEmpty=!1,u(e,a).innerHTML="")):("none"==y&&(y="mark"),"mark"==y&&(console.log("marking"),t[e][a].markedAsEmpty=!0,u(e,a).innerHTML='<i class="icon-flag"></i>')))}function b(e,n,r=!1,i=!1){if("underway"!=s.state&&!i||e<0||e>=s.board.rows||n<0||n>=s.board.columns||t[e][n].uncovered)return null;if(t[e][n].hasMine&&!t[e][n].markedAsEmpty){u(e,n).innerHTML="<i class='icon-mine'></i>",u(e,n).dataset.clickable="false",t[e][n].uncovered=!0;for(let a=-1;a<=1;a++)for(let t=-1;t<=1;t++)0==a&&0==t||b(e+a,n+t,!0,i);s.minesLeft--,0==s.minesLeft&&"underway"==s.state&&(a.playarea.winOverlay.container.classList.remove("fade"),a.playarea.winOverlay.container.classList.add("visible"),a.playarea.board.container.classList.add("no-input"),s.state="finished",clearInterval(o))}else r?(t[e][n].uncovered=!0,t[e][n].markedAsEmpty=!1,u(e,n).innerHTML=t[e][n].numOfNearbyMines,u(e,n).dataset.clickable="false"):t[e][n].markedAsEmpty||"underway"!=s.state||(u(e,n).classList.add("wrong-tile"),a.playarea.loseOverlay.container.classList.remove("fade"),a.playarea.loseOverlay.container.classList.add("visible"),a.playarea.board.container.classList.add("no-input"),s.state="finished",clearInterval(o))}function g(){s.time.seconds++,s.time.seconds>=60&&(s.time.seconds-=60,s.time.minutes++),s.time.minutes<=9?a.nav.timer.minutes.innerHTML=`0${s.time.minutes}`:a.nav.timer.minutes.innerHTML=s.time.minutes,s.time.seconds<=9?a.nav.timer.seconds.innerHTML=`0${s.time.seconds}`:a.nav.timer.seconds.innerHTML=s.time.seconds}let f,w=!1,L=!1;function h(){s.boardSize=r.boardSize,"custom"!=r.boardSize?Object.assign(s.board,i[s.boardSize]):Object.assign(s.board,r.board),a.modals.settings.boardApplyWarning.style.removeProperty("display"),s.hints=1+Math.floor(s.board.columns*s.board.rows/400),s.hintMode=!1,a.nav.hintBtn.dataset.hints=s.hints,a.nav.hintBtn.classList.remove("hint-active"),a.nav.hintBtn.classList.remove("hint-disabled"),function(){t=[];for(let e=0;e<s.board.rows;e++){t[e]=[];for(let a=0;a<s.board.columns;a++)t[e][a]=new n}}(),function(){let e="";for(let a in t){e+="<div>";for(let n in t[a])e+=`<div data-row="${a}" data-column="${n}"></div>`;e+="</div>"}a.playarea.board.container.innerHTML=e,a.playarea.board.tiles=document.querySelectorAll("[data-row][data-column]");for(let e of a.playarea.board.tiles)e.addEventListener("pointerdown",(t=>{t.isPrimary&&!w?(2==t.button?p(parseInt(e.dataset.row),parseInt(e.dataset.column)):f=setTimeout((()=>{a.markCircleDiv.classList.add("hold"),d(100),a.markCircleDiv.style.top=t.clientY-80+"px",a.markCircleDiv.style.left=t.clientX-80+"px",f=setTimeout((()=>{a.markCircle.style.stroke="#0007",L=!0,a.playarea.board.container.style.touchAction="none",p(parseInt(e.dataset.row),parseInt(e.dataset.column))}),400)}),300),t.target.releasePointerCapture(t.pointerId)):w=!0})),e.addEventListener("pointerup",(a=>{a.isPrimary&&(a.isPrimary&&w?w=!1:(L||0!=a.button||v(parseInt(e.dataset.row),parseInt(e.dataset.column)),clearTimeout(f)))})),e.addEventListener("contextmenu",(e=>(e.preventDefault(),!1))),e.addEventListener("pointermove",(e=>{e.isPrimary&&(a.markCircleDiv.style.top=e.clientY-80+"px",a.markCircleDiv.style.left=e.clientX-80+"px")})),e.addEventListener("pointerenter",(a=>{a.isPrimary&&(L||2==a.buttons)&&p(parseInt(e.dataset.row),parseInt(e.dataset.column))})),e.addEventListener("pointercancel",(e=>{a.markCircleDiv.classList.remove("hold"),a.markCircle.style.stroke="#000F",d(0),clearTimeout(f),L=!1,y="none"}))}(),function(){let e="";for(let a=0;a<s.board.rows;a++)e+="<div>#</div>";a.playarea.rowNums.innerHTML=e,e="";for(let a=0;a<s.board.columns;a++)e+="<div>#</div>";a.playarea.columnNums.innerHTML=e}(),s.state="initial",clearInterval(o),s.time.minutes=s.time.seconds=0,a.nav.timer.minutes.innerHTML=a.nav.timer.seconds.innerHTML="00",a.playarea.board.container.classList.remove("no-input"),a.nav.mineCounter.innerHTML=s.minesLeft=s.board.numOfMines}document.body.addEventListener("pointerup",(()=>{a.markCircleDiv.classList.remove("hold"),a.markCircle.style.stroke="#000F",d(0),L=!1,a.playarea.board.container.style.removeProperty("touch-action"),clearTimeout(f),y="none"})),a.nav.newGameBtn.addEventListener("click",(e=>{h()})),a.nav.hintBtn.addEventListener("click",(()=>{s.hints>=1&&(a.nav.hintBtn.classList.toggle("hint-active"),s.hintMode=!s.hintMode)})),document.querySelectorAll("[data-modalopen]").forEach((e=>{e.addEventListener("click",(()=>{a.modals.container.classList.add("visible"),a.modals.container.classList.remove("fade"),document.querySelector(e.dataset.modalopen).classList.add("visible"),document.querySelector(e.dataset.modalopen).classList.remove("fade")}))})),document.querySelectorAll(".modal-close").forEach((e=>{e.addEventListener("click",(()=>{a.modals.container.classList.add("fade"),a.modals.container.classList.remove("visible"),e.parentNode.parentNode.classList.add("fade"),e.parentNode.parentNode.classList.remove("visible")}))})),a.modals.settings.container.querySelector(".modal-close").addEventListener("click",(()=>{"underway"!=s.state&&h()})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===t.currentTarget&&(a.modals.container.classList.add("fade"),a.modals.container.classList.remove("visible"),e.classList.add("fade"),e.classList.remove("visible"))}))})),a.modals.settings.container.addEventListener("click",(()=>{"underway"!=s.state&&h()})),a.modals.menu.btns.querySelectorAll("button").forEach((e=>{e.addEventListener("click",(()=>{a.modals.menu.container.classList.add("fade"),a.modals.menu.container.classList.remove("visible")}))})),a.playarea.board.container.addEventListener("scroll",(()=>{a.playarea.rowNums.scroll(0,a.playarea.board.container.scrollTop),a.playarea.columnNums.scroll(a.playarea.board.container.scrollLeft,0)}),{passive:!0}),a.playarea.winOverlay.newGameBtn.addEventListener("click",(()=>{h(),a.playarea.winOverlay.container.classList.add("fade"),a.playarea.winOverlay.container.classList.remove("visible")})),a.playarea.winOverlay.viewBoardBtn.addEventListener("click",(()=>{a.playarea.winOverlay.container.classList.add("fade"),a.playarea.winOverlay.container.classList.remove("visible")})),a.playarea.loseOverlay.newGameBtn.addEventListener("click",(()=>{h(),a.playarea.loseOverlay.container.classList.add("fade"),a.playarea.loseOverlay.container.classList.remove("visible")})),a.playarea.loseOverlay.viewBoardBtn.addEventListener("click",(()=>{a.playarea.loseOverlay.container.classList.add("fade"),a.playarea.loseOverlay.container.classList.remove("visible"),function(){for(let e in t)for(let a in t[e])t[e][a].hasMine&&!t[e][a].uncovered?(u(e,a).innerHTML="<i class='icon-mine'></i>",u(e,a).dataset.clickable="false"):u(e,a).innerHTML=t[e][a].numOfNearbyMines}()})),a.modals.settings.boardSize.addEventListener("change",(e=>{r.boardSize=e.target.value,"underway"==s.state&&(a.modals.settings.boardApplyWarning.style.display="block")}));const M=/^[0-9]+$/g;a.modals.settings.customBoard.columns.addEventListener("input",(e=>{e.target.value=e.target.value.match(M),e.target.value?e.target.value>100&&!S?(e.target.value=100,r.board.columns=parseInt(e.target.value)):r.board.columns=parseInt(e.target.value):r.board.columns=5,k(),"underway"==s.state&&(a.modals.settings.boardApplyWarning.style.display="block")})),a.modals.settings.customBoard.columns.addEventListener("blur",(e=>{!e.target.value||e.target.value<5?e.target.value=5:e.target.value>100&&!S&&(e.target.value=100),r.board.columns=parseInt(e.target.value),k(),"underway"==s.state&&(a.modals.settings.boardApplyWarning.style.display="block")})),a.modals.settings.customBoard.rows.addEventListener("input",(e=>{e.target.value=e.target.value.match(M),""==e.target.value?r.board.rows=5:e.target.value>100&&!S?(e.target.value=100,r.board.rows=parseInt(e.target.value)):r.board.rows=parseInt(e.target.value),k(),"underway"==s.state&&(a.modals.settings.boardApplyWarning.style.display="block")})),a.modals.settings.customBoard.rows.addEventListener("blur",(e=>{""==e.target.value||e.target.value<5?e.target.value=5:e.target.value>100&&!S&&(e.target.value=100),r.board.rows=parseInt(e.target.value),k(),"underway"==s.state&&(a.modals.settings.boardApplyWarning.style.display="block")})),a.modals.settings.customBoard.numOfMines.addEventListener("input",(e=>{e.target.value>r.maxMines?e.target.value=r.maxMines:(e.target.value<2||!e.target.value)&&(e.target.value=2),r.board.numOfMines=parseInt(e.target.value),"underway"==s.state?a.modals.settings.boardApplyWarning.style.display="block":s.board.numOfMines=parseInt(e.target.value)})),a.nav.markSwapBtn.addEventListener("click",(()=>{s.clickSwap=!s.clickSwap,s.clickSwap?(a.nav.markSwapBtn.innerHTML='<i class="icon-flag"></i>',a.playarea.board.container.classList.add("no-scroll")):(a.nav.markSwapBtn.innerHTML='<i class="icon-mine"></i>',a.playarea.board.container.classList.remove("no-scroll"))}));function k(){let e=Math.floor(r.board.columns*r.board.rows/2);e<25&&(e=25),a.modals.settings.customBoard.maxMines.innerHTML=r.maxMines=e,a.modals.settings.customBoard.numOfMines.value>r.maxMines&&(a.modals.settings.customBoard.numOfMines.value=r.maxMines),r.board.numOfMines=parseInt(a.modals.settings.customBoard.numOfMines.value)}window.matchMedia("only screen and (max-width: 767px)").addEventListener("change",(e=>{e.matches||(s.clickSwap=!1,a.playarea.board.container.classList.remove("no-scroll"),a.nav.markSwapBtn.innerHTML='<i class="icon-mine"></i>')})),a.modals.settings.boardSize.addEventListener("change",(e=>{a.modals.settings.customBoard.container.style.height=`${a.modals.settings.customBoard.container.scrollHeight}px`,"custom"==e.target.value?(a.modals.settings.customBoard.container.classList.add("open"),a.modals.settings.customBoard.container.addEventListener("transitionend",(()=>{a.modals.settings.customBoard.container.style.removeProperty("height")}),{once:!0})):(a.modals.settings.customBoard.container.classList.remove("open"),window.setTimeout((()=>{a.modals.settings.customBoard.container.style.removeProperty("height")})))}));let B=document.documentElement;a.modals.settings.tileSize.addEventListener("input",(e=>{B.style.setProperty("--tile-size",`${e.target.value}px`)})),h();const E=new URLSearchParams(window.location.search);let S=!1;E.has("customBoardUnlimited")&&(bulkUnlimited=!0);function O(e,a){const t=e.value,n=e.min?e.min:0,s=e.max?e.max:100,r=Number(100*(t-n)/(s-n));a.innerHTML=t,a.style.left=`calc(${r}% + (${8-.15*r}px))`}document.querySelectorAll(".range-wrap").forEach((e=>{const a=e.querySelector('[type="range"]'),t=e.querySelector(".bubble");a.addEventListener("input",(()=>{O(a,t)})),O(a,t)}));let C=0,T=e("xyzzypixel");function x(){a.playarea.board.tiles.forEach((e=>{e.addEventListener("mouseover",(()=>{s.xyzzyShift&&(t[e.dataset.row][e.dataset.column].hasMine?T.style.backgroundColor="#000":T.style.backgroundColor="#FFF")}))}))}document.onkeydown=e=>{e.key=="xyzzy"[C]?C++:C=0,C>=5&&(x(),s.xyzzyActivated=!0,document.onkeydown=e=>{"Shift"==e.key&&(s.xyzzyShift=!0)},document.onkeyup=e=>{"Shift"==e.key&&(s.xyzzyShift=!1)})}}()}();
//# sourceMappingURL=index.976a0b81.js.map
